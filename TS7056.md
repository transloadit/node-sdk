### TS7056 ("type exceeds maximum length")

The TS7056 error occurs when TypeScript's type inference system encounters types that are too complex to serialize during declaration file generation. This happens with our large discriminated unions in the robot schemas.

#### Current Solution: Patch-based declaration generation

We use a custom build process that temporarily patches the source files with type annotations during declaration generation, then restores the original files. This approach:

1. Keeps the source code clean and compatible with both repos
2. Applies minimal type annotations only during the build process
3. Generates proper declaration files without TS7056 errors
4. Maintains full type safety and discriminated union functionality

#### Implementation Details

The solution consists of two scripts:

1. `scripts/build.ts` - Main build script that:

   - Compiles TypeScript to JavaScript
   - Calls the type generation script

2. `scripts/generate-types.ts` - Type generation script that:
   - Creates backups of problematic files
   - Applies temporary type annotations to avoid TS7056
   - Generates declaration files using TypeScript compiler
   - Restores original files

The patches add generic type annotations like `z.ZodType` or `z.ZodDiscriminatedUnion<"robot", z.ZodDiscriminatedUnionOption<"robot">[]>` to the problematic schemas, which prevents TypeScript from trying to serialize the entire union structure.

#### Why this approach works

- The source files remain unchanged, so the code works identically in both `node-sdk` and `content` repos
- The type annotations are only applied temporarily during build, avoiding any runtime impact
- The generated declaration files are properly typed without hitting serialization limits
- The discriminated union structure is preserved, maintaining compatibility with code that accesses internal properties

#### Alternative approaches considered

1. **Facade types** - Would have solved TS7056 but broke compatibility with code accessing internal union properties
2. **d.ts bundlers** (rollup-dts, dts-bundle-generator, API Extractor) - These tools also hit the same TS7056 errors when processing the complex types
3. **Permanent type annotations** - Would require `any` types and eslint-disable comments, making the code less clean

The patch-based approach provides the best balance of maintainability, compatibility, and type safety.
